{"pageProps":{"entries":{"items":[{"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"2widkdbc59vz"}},"id":"7nlO5xm0vmZCt4N1aDXRNC","type":"Entry","createdAt":"2020-05-27T09:06:29.077Z","updatedAt":"2020-06-03T09:46:21.680Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"revision":4,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"post"}},"locale":"en-US"},"fields":{"title":"作品の書き出しなども取得できるちょっと便利な青空文庫API「ZORAPI（ゾラピ）」ベータ版を公開しました","slug":"2019/10/01/182951","excerpt":"![f:id:o_tomomichi:20191002085846p:plain](https://storage.googleapis.com/blog-notsobad/images/20191002085846.png \"f:id:o_tomomichi:20191002085846p:plain\")\n\n[ブンゴウメール](https://bungomail.com/)や[ゾラサーチ](https://search.bungomail.com/)など、青空文庫を活用したサービスを色々作っています。 その関係で青空文庫APIがほしくて眠れない日々が続いていたので、作りました。\n\n「AOZORA」+「API」で「ZORAPI（ゾラピ）」です。\n\n[青空文庫API - ZORAPI（ゾラピ）](https://api.bungomail.com/)\n\n「ゾラサーチ」というのが青空文庫を読了時間で検索できるようにしたサービスで、このAPIはそのデータを誰でも使えるように一般公開したものです。 そのため通常の作品情報に加えて、作品の文字数や書き出し・青空文庫での累計アクセス数などの情報も返してくれるあたりがちょっといい感じかと思います。\n\n例えばメロスだとこんな感じ：[https://api.bungomail.com/v0/books/1567](https://api.bungomail.com/v0/books/1567)\n\nまだまだ不具合もありそうだけど、一旦使えるようにはなったので公開してみます。 v0なのでいろいろ許してください（フィードバック大歓迎です）。","content":"![f:id:o_tomomichi:20191002085846p:plain](https://storage.googleapis.com/blog-notsobad/images/20191002085846.png \"f:id:o_tomomichi:20191002085846p:plain\")\n\n[ブンゴウメール](https://bungomail.com/)や[ゾラサーチ](https://search.bungomail.com/)など、青空文庫を活用したサービスを色々作っています。 その関係で青空文庫APIがほしくて眠れない日々が続いていたので、作りました。\n\n「AOZORA」+「API」で「ZORAPI（ゾラピ）」です。\n\n[青空文庫API - ZORAPI（ゾラピ）](https://api.bungomail.com/)\n\n「ゾラサーチ」というのが青空文庫を読了時間で検索できるようにしたサービスで、このAPIはそのデータを誰でも使えるように一般公開したものです。 そのため通常の作品情報に加えて、作品の文字数や書き出し・青空文庫での累計アクセス数などの情報も返してくれるあたりがちょっといい感じかと思います。\n\n例えばメロスだとこんな感じ：[https://api.bungomail.com/v0/books/1567](https://api.bungomail.com/v0/books/1567)\n\nまだまだ不具合もありそうだけど、一旦使えるようにはなったので公開してみます。 v0なのでいろいろ許してください（フィードバック大歓迎です）。* * *\n\nつくったもの\n------\n\n青空文庫には2019年9月現在で約1.6万件の作品データ、約1,000件程度の人物（著者・翻訳者など）データが登録されています。 公式がこれをまとめた巨大なCSVファイルを自動更新で公開してくれているので、基本的にこのデータを検索して返すAPIとなっています。\n\n公式CSVをスプレッドシートに取り込んで公開してるので、どんなデータが返ってくるかはこれを見てもらうのが早いかと。 （実際のResponseフォーマットは一部異なるので、詳細は[ドキュメント](https://api.bungomail.com/)をご参照ください）\n\n[青空文庫API用データ - Google スプレッドシート](https://docs.google.com/spreadsheets/d/1n04e6POI04TBt-3HJUH10-T5cxhPZHcBWmFA4tSHjqE/edit?usp=sharing)\n\n公式CSVは毎日更新されてますが、ほとんどの場合そんなに最新のデータが必要になるわけじゃないと思うので、データ更新は不定期で対応する予定です。APIで取れるデータの最新情報は前述のスプレッドシートで確認してください。\n\n* * *\n\n使い方\n---\n\nbooks, personsそれぞれのエンドポイントに対して、カラム名での検索と、ID指定で特定ドキュメントの取得ができます。 検索は基本完全一致ですが、一部カラムはLIKE検索もサポートしています（後述）。\n\n#### 検索（一覧取得）\n\n*   [https://api.bungomail.com/v0/books?作品名=桃太郎](https://api.bungomail.com/v0/books?作品名=桃太郎)\n*   [https://api.bungomail.com/v0/books?作品著作権フラグ=なし&文字遣い種別=新字新仮名&limit=5](https://api.bungomail.com/v0/books?作品著作権フラグ=なし&文字遣い種別=新字新仮名&limit=5)\n*   [https://api.bungomail.com/v0/persons?人物著作権フラグ=なし&limit=5](https://api.bungomail.com/v0/persons?人物著作権フラグ=なし&limit=5)\n\n検索対象となるのは、スプレッドシートでオレンジ色になっているカラムです。 対象カラムであれば、上記の例のように複数組み合わせて絞り込み（AND検索）することもできます。\n\n#### 特定レコード取得\n\n*   [https://api.bungomail.com/v0/books/1567](https://api.bungomail.com/v0/books/1567)（作品ID）\n*   [https://api.bungomail.com/v0/persons/35](https://api.bungomail.com/v0/persons/35)（人物ID）\n\n詳細な使い方やレスポンスのフォーマットについては[ドキュメント](https://api.bungomail.com)をご参照ください。\n\n* * *\n\nアピールポイント\n--------\n\n### 作品の文字数・書き出し・累計アクセス数も取れる\n\n公式のCSVで得られる情報に加えて、「ゾラサーチ」で利用している独自データも追加しています。 具体的には「作品の文字数」「書き出し」「累計アクセス数」です。\n\n夢が広がりますね。\n\n### LIKE検索も（一部）サポート\n\nFirestoreを使ってるので検索が弱く、基本的に検索は完全一致となります。 たださすがにフリーワード検索したいこともあるので、一部カラムでLIKE検索もサポートしました。\n\nbooksの「作品名」、personsの「姓名」カラムが、それぞれLIKE検索に対応しています。\n\n*   [https://api.bungomail.com/v0/books?作品名=/走れ/&姓名=太宰治](https://api.bungomail.com/v0/books?作品名=/走れ/&姓名=太宰治)\n\nのように`//`で囲んでお使いください。他のカラムとの併用も可能です。\n\nFirestoreで全文検索する方法はこちらの記事を参考にさせていただきました。\n\n[qiita.com](https://qiita.com/oukayuka/items/d3cee72501a55e8be44a)\n\n控えめに言って天才としか言いようがないメソッドですので、Firestore使う方はぜひご参考ください。 感謝しすぎてreact使ったこともないのに「りあクト！」新刊買ってしまいましたw\n\n* * *\n\n限界\n--\n\nこんな感じのAPIなんですが、無料運営にこだわってFirestoreに依存している結果、弱点も多いです。許してください。\n\n##### 並べ替えができない\n\nすべてのレスポンスが「累計アクセス数↓・作品ID↑」順でソートされております。 これ以外でのソートはできません。文字数とか名前とかで並べたいよね。ごめんね。\n\nしかし複合indexの組み合わせが爆発するので、とてもすべてはindexできそうにありません。 どうしてもこの条件でソートしなければ死ぬ、とかの要件があればご相談ください。 （でもそこまで追い詰められてたら自前でデータ取り込んで検索したほうがいいと思います）\n\n##### アクセス数が爆増したら登録制にするかも\n\nFirebaseの無料プランで運営しているため、当然使用量に制限があります。 検索結果は超長期でCDNキャッシュする予定ですが、それでもアクセスが多すぎる場合は登録制にして利用を制限するかもしれません。あらかじめご了承ください。たぶんそんなことにはならないと思うんですけど。\n\nまた全データ取得の目的でAPI投げまくるとかを検討されている場合、たぶん公開してるスプレッドシートをダウンロードして直接読み込んでもらったほうがお互いハッピーだと思いますので、ぜひそちらをご検討ください。\n\n* * *\n\nまとめ\n---\n\nという感じで、まぁいろいろ制限はありますが何とか使えなくもないAPIができたんじゃないかと思います。\n\nがんばりすぎずに長生きしてほしいなと思ってますので、これでもいいよという方はぜひ使ってみてください。 バグや改善要望、使ってみたレポートもお待ちしておりますよ。\n\nおしまい。","date":1569922191000,"image":"https://storage.googleapis.com/blog-notsobad/images/20191002085846.png","tag":["つくったもの","ゾラサーチ","ZORAPI","青空文庫"]}},{"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"2widkdbc59vz"}},"id":"1SE2cNJulQLzNKJU96JJpQ","type":"Entry","createdAt":"2020-05-27T09:06:31.379Z","updatedAt":"2020-06-03T09:46:28.242Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"revision":4,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"post"}},"locale":"en-US"},"fields":{"title":"青空文庫の作品を目安の読了時間で検索できるサービス「ゾラサーチ」をリリースしました","slug":"2019/04/04/133409","excerpt":"![f:id:o_tomomichi:20190403115005p:plain](https://storage.googleapis.com/blog-notsobad/images/20190403115005.png \"f:id:o_tomomichi:20190403115005p:plain\")\n\nタイトルのまんまですが、また地味なサービスを作りました。 よかったら見てみてください。\n\n\\[2020.4.1追記\\]  \nサービス名を「ゾラサーチ」から「ブンゴウサーチ」に変更しました。\n\n[search.bungomail.com](http://search.bungomail.com/)","content":"![f:id:o_tomomichi:20190403115005p:plain](https://storage.googleapis.com/blog-notsobad/images/20190403115005.png \"f:id:o_tomomichi:20190403115005p:plain\")\n\nタイトルのまんまですが、また地味なサービスを作りました。 よかったら見てみてください。\n\n\\[2020.4.1追記\\]  \nサービス名を「ゾラサーチ」から「ブンゴウサーチ」に変更しました。\n\n[search.bungomail.com](http://search.bungomail.com/)* * *\n\nこれはなに？\n------\n\n青空文庫の作品を目安の読了時間で検索できるサービスです。 たとえばこんな感じで、「5分で読める芥川竜之介の短編」みたいに探すことができます。\n\n![f:id:o_tomomichi:20190330163010p:plain](https://storage.googleapis.com/blog-notsobad/images/20190330163010.png \"f:id:o_tomomichi:20190330163010p:plain\")\n\n[5分以内で読める芥川竜之介の短編作品 | ゾラサーチ](https://search.bungomail.com/authors/879/categories/flash/books)\n\nもちろん読書スピードは人によって激しく違うので、あくまで目安として参考にしてください。 （読了時間の算出基準などは[こちら](https://search.bungomail.com/about)に書いています）\n\nまた作品の文字数（これも目安ですが）も載せているので、慣れてきたらそこから自分の読了時間を大体予測できるかもしれません。\n\nアピールポイント\n--------\n\n*   デフォルトで人気の作品順に並ぶのでいい感じに探せる（※）\n*   本の書き出し部分もチラ見せしてくれる（スマホでは作品詳細画面のみ）\n*   けっこうサクサク動く（はず）\n\n※作品の人気度は、過去10年分の青空文庫アクセスランキングの累計を基に算出。\n\nなんで作ったの？\n--------\n\n青空文庫の公式サイトは一覧性を重視した作りになっていて、特定の本を探すには便利ですが、知らない本と出会うのはなかなか難しかったりします。 なのでそれを解決するサービスを作りたいと思ったのが開発の動機です。\n\n特に自分の場合だと、実際に読む前にその本の長さがけっこう気になります。 「今日は1日カフェにこもってじっくり長編を読むぞー」なのか、「寝る前に30分くらいでさくっと読める短編ないかなー」なのか。\n\nしかし現状の青空文庫では実際に作品を選ばないとどれくらいの長さなのかわからないので、なかなかこのニーズにマッチしません。 また青空文庫リーダー系のアプリもいくつか見ましたが、同様の機能を提供するものはなさそうです。なので作りました。\n\nほんとにそれだけ？\n---------\n\n鋭いですね。実は他にも背景があります。\n\n#### ブンゴウメールというのをやってまして\n\n青空文庫の作品を小分けにして毎日メールで配信してくれる、「ブンゴウメール」というサービスを運営しています。 （意外とおもしろいので、まだの方はぜひ登録してね）\n\n[bungomail.com](https://bungomail.com)\n\n最近忙しくて読書できていない方や、ふだんあまり文学を読まない方からも多く利用いただいています。 で、うれしいことに「ブンゴウメールをきっかけに読書の習慣ができて、自分でも本を読むようになった」という報告をいただいたりします（うれしい！）。\n\nというわけで、「ブンゴウメールで初めて夢野久作を読んで、他の作品も読んでみたくなった」みたいな方がいい感じに次の本を探せるサービスを作りたい、というのも制作の背景としてありました。（逆にブンゴウメールへの集客施策の一環という位置づけもあります）\n\nさらにちなみの裏話としては、ブンゴウメールのために青空文庫の全作品のテキストを解析して分割保存するということをしており、せっかくなのでこの大量に溜まったデータを何か活用できないかなーという背景もありました。\n\n※青空文庫は作品データをすべてGithubに公開してくれており、ブンゴウメール・ゾラサーチともそこからデータを取得して利用しています。クローリングなどによる青空文庫本体へのシステム負荷は一切ありませんので安心してお使いください。\n\n#### 青空文庫にもお返ししたい\n\nとってつけたように最後に書いてますが、実はこれもずっと考えていたことでして。\n\nご存知の方も多いと思いますが、青空文庫の作品はボランティアの方によってひとつひとつ入力されています。 青空文庫自体がもはや一種のインフラみたいな存在になっていますが、それが存在できているのは全然当たり前のことではないのです。\n\n自分も青空文庫の恩恵を多大に受けているので、何かお返しをしたいとは常々思ってまして。 その一環として、ブンゴウメールの有料版を作って収益の一部を青空文庫の活動支援に還元するということも始めました。\n\n[https://bungomail.com/pro](https://bungomail.com/pro)\n\nただ残念ながら金額的に大した貢献にはならないので（マネタイズむずかしい）、もっと自分が得意なところで何か貢献したいなと。 というわけで、Webエンジニアらしく青空文庫をもっと便利にするサービスを開発してみたという背景もありました。\n\nちなみに、青空文庫には現状専属のエンジニアがおらず、ボランティアベースで維持・改善が行われている状態です。 （それであの規模のシステムが稼働し続けているのは本当にすごい）\n\n有志による青空文庫を技術的に支える活動「aozorahack」というのもあるので、興味のある方はぜひ参加してみてください！ （自分はまだ何も貢献できてない。。）\n\n[aozorahack](https://aozorahack.org/)\n\n* * *\n\nまとめ\n---\n\nというわけで、個人的にはけっこう便利なサービスになったので満足しております。 何か新しい本読んでみようかなーというときにでもぜひお使いください。\n\n[search.bungomail.com](https://search.bungomail.com)\n\n引き続きブンゴウメールもよろしくね。\n\n[bungomail.com](https://bungomail.com)\n\nおしまい。","date":1554352449000,"image":"https://storage.googleapis.com/blog-notsobad/images/20190403115005.png","tag":["つくったもの","ゾラサーチ","ブンゴウメール","青空文庫"]}}]},"tag":"青空文庫","page":1,"hasNextPage":false},"__N_SSG":true}